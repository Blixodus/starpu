# Variables d'environnements : 
# ALGO_USED : 	1 pour l'algo qui regroupe les paquets qui atteignent tous la valeurs maximale du poids des données communes. 
#				2 pour l'algo qui fais un regroupement de paquets puis recalcule le maximun du poids.
#				3
# RANDOM_TASK_ORDER : 0 pour ne pas mélanger l'ordre des tâches, 1 pour mélanger.
# STARPU_WORKER_STATS pour un fichier de sortie
# 4 8 12 16 24 32 40 48 pour l'ordre Z

truncate -s 0 GFlops_raw_out.txt
ulimit -S -s 50000
echo "EAGER"
STARPU_SCHED=eager STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*4)) -nblocks 4 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=eager STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*5)) -nblocks 5 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=eager STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*6)) -nblocks 6 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=eager STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*7)) -nblocks 7 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=eager STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*8)) -nblocks 8 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
echo "DMDAR"
STARPU_SCHED=dmdar STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*4)) -nblocks 4 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=dmdar STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*5)) -nblocks 5 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=dmdar STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*6)) -nblocks 6 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=dmdar STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*7)) -nblocks 7 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=dmdar STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*8)) -nblocks 8 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
echo "LWS"
STARPU_SCHED=lws STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*4)) -nblocks 4 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=lws STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*5)) -nblocks 5 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=lws STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*6)) -nblocks 6 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=lws STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*7)) -nblocks 7 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
STARPU_SCHED=lws STARPU_LIMIT_BANDWIDTH=500 STARPU_LIMIT_CUDA_MEM=500 RANDOM_TASK_ORDER=0 STARPU_DIDUSE_BARRIER=1 STARPU_NCPU=0 STARPU_NCUDA=1 STARPU_NOPENCL=0 STARPU_HOSTNAME=attila ./examples/mult/sgemm -xy $((960*8)) -nblocks 8 -iter 1 | tail -n 1 >> GFlops_raw_out.txt
gcc -o cut_gflops_raw_out cut_gflops_raw_out.c
./cut_gflops_raw_out 5 3
